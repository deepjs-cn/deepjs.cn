import{_ as e,o as a,c as l,V as t}from"./chunks/framework.75ed6a74.js";const i=JSON.parse('{"title":"UTM 来源路径跟踪模块","description":"","frontmatter":{},"headers":[{"level":3,"title":"UTM 简介","slug":"utm-简介","link":"#utm-简介","children":[]},{"level":3,"title":"Urchin","slug":"urchin","link":"#urchin","children":[]},{"level":3,"title":"UTM 模型","slug":"utm-模型","link":"#utm-模型","children":[]},{"level":3,"title":"如何设计","slug":"如何设计","link":"#如何设计","children":[]},{"level":3,"title":"扩展","slug":"扩展","link":"#扩展","children":[]},{"level":3,"title":"设计要点","slug":"设计要点","link":"#设计要点","children":[]},{"level":3,"title":"用途","slug":"用途","link":"#用途","children":[]},{"level":3,"title":"数据分析","slug":"数据分析","link":"#数据分析","children":[]}],"relativePath":"system-design/event-tracking/utm.md","filePath":"system-design/event-tracking/utm.md"}'),n={name:"system-design/event-tracking/utm.md"},r=[t('<h1 id="utm-来源路径跟踪模块" tabindex="-1">UTM 来源路径跟踪模块 <a class="header-anchor" href="#utm-来源路径跟踪模块" aria-label="Permalink to &quot;UTM 来源路径跟踪模块&quot;">​</a></h1><blockquote><p>UTM（Urchin tracking module，Urchin [ˈɜːtʃɪn] 跟踪模块）是在数据采集领域的一个标准数据结构范式，通过这个模型，对网页、界面的来源进行数据收集，进而分析营销效果和用户的行为路径。</p></blockquote><h3 id="utm-简介" tabindex="-1">UTM 简介 <a class="header-anchor" href="#utm-简介" aria-label="Permalink to &quot;UTM 简介&quot;">​</a></h3><p>UTM 全称 Urchin tracking module，来源于海胆软件公司（Urchin Software Corporation）， 2005 年它被 Google 收购，他们的软件为我们现在所知的谷歌分析（Google Analytics）打下了基础。</p><p>UTM 码是可以添加到一个链接中的一些文本，它能告诉谷歌分析（以及其他分析工具）关于每个链接的更多信息。 下面是一个示例：</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">https://www.baidu.com/p/utm?utm_campaign=ad&amp;utm_medium=social&amp;utm_source=wechat</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>上述 URL 中的几个 utm 开头的参数参考后端服务的处理，会收集到数据仓库并用于数据分析，进而分析营销效果和用户的行为路径。</p><p>上述 URL 中的几个 utm 开头的参数参考后端服务的处理，会收集到数据仓库并用于数据分析，进而分析营销效果和用户的行为路径。</p><p>UTM 五大标准参数图示</p><p><img src="/assets/utm-parameters.41d747f1.jpg" alt="UTM 五大标准参数图示"></p><p>UTM 代码可以跟踪介质和介质中的源，它变得更灵活的地方是你用来描述源代码的语言。也许你想把网站流量归因于一个社交网络，一种内容，甚至是网上广告的确切名称。</p><h3 id="urchin" tabindex="-1">Urchin <a class="header-anchor" href="#urchin" aria-label="Permalink to &quot;Urchin&quot;">​</a></h3><p>海胆（Urchin）是一个停止服务的网络统计分析程序，是由海胆软件公司开发的。海胆成为一个更流行的解决方案，网站流量分析，特别是与互联网服务提供商和网络托管提供商。这在很大程度上是由于它在性能和定价模型方面的可扩展性。</p><p>2005 年 4 月，谷歌收购了海胆软件公司（Urchin Software Corporation）。谷歌的服务是由 Urchin on Demand 开发的。该系统还引入了 Adaptive Path 的理念，Adaptive Path 的产品 Measure Map 于 2006 年被收购并用于重新设计 Google Analytics。谷歌继续通过增值转销商网络销售独立的、可安装的 Urchin WebAnalytics 软件，直到 2012 年 3 月 28 日停止销售。谷歌品牌的版本于 2005 年 11 月向所有希望注册的人推出。</p><h3 id="utm-模型" tabindex="-1">UTM 模型 <a class="header-anchor" href="#utm-模型" aria-label="Permalink to &quot;UTM 模型&quot;">​</a></h3><p>UTM 以参数形式包含在 URL（网页地址）或者 APP、小程序的路径中，UTM 信息是外显的，可以通过浏览器的地址栏看到。</p><p>标准的 UTM 有五个参数：</p><table><thead><tr><th>参数</th><th>内容</th><th>说明</th></tr></thead><tbody><tr><td>Campaign</td><td>活动名称</td><td>用来标记广告或运营活动的整体的名称</td></tr><tr><td>Source</td><td>广告来源</td><td>用来标记网站、邮箱、应用等来源</td></tr><tr><td>Medium</td><td>广告媒介</td><td>用来标记 Banner、CPC 等广告形式</td></tr><tr><td>Content</td><td>关键词</td><td>用来标记广告关键词，主要用于 SEM 投放</td></tr><tr><td>Term</td><td>广告内容</td><td>主要用于 A/B 测试，标记同一广告间细微差别</td></tr></tbody></table><p>以下是使用 UTM 代码可以跟踪的五件事以及跟踪它们的原因：</p><h4 id="a-campaign" tabindex="-1">A Campaign <a class="header-anchor" href="#a-campaign" aria-label="Permalink to &quot;A Campaign&quot;">​</a></h4><p>基于活动的跟踪标记将分析中一个活动的所有内容分组。下面的示例 UTM 代码将帮助您将网站流量归因于作为 20%折扣促销的一部分而放置的链接。</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">utm_campaign=20percentpromocode</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="a-source" tabindex="-1">A Source <a class="header-anchor" href="#a-source" aria-label="Permalink to &quot;A Source&quot;">​</a></h4><p>基于源代码的 URL 参数可以告诉您哪个网站正在向您发送流量。您可以将下面的示例代码添加到您发布到 Weibo 页面的每个链接中，帮助您跟踪来自 Weibo 的所有流量。</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">utm_source=Weibo</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="a-medium" tabindex="-1">A Medium <a class="header-anchor" href="#a-medium" aria-label="Permalink to &quot;A Medium&quot;">​</a></h4><p>这种类型的跟踪标记通知您跟踪链接所在的媒体。您可以使用下面的示例 UTM 代码来跟踪来自社交媒体的所有流量（与电子邮件等其他媒体不同）。</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">utm_medium=socialmedia</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="a-piece-of-content" tabindex="-1">A Piece of Content <a class="header-anchor" href="#a-piece-of-content" aria-label="Permalink to &quot;A Piece of Content&quot;">​</a></h4><p>这种类型的 UTM 代码用于跟踪从公共源和媒体指向同一目的地的特定类型的内容。它通常用于按点击付费（PPC）活动，或者在同一页面上有两个相同的链接，如下面的示例 UTM 代码所示。</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">utm_content=sidebarlink / utm_content=headerlink</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="a-term" tabindex="-1">A Term <a class="header-anchor" href="#a-term" aria-label="Permalink to &quot;A Term&quot;">​</a></h4><p>基于术语或关键字的跟踪代码标识您在 PPC 广告中支付的关键字。如果您为 Google 广告活动支付费用，以在关键字“marketing software”下排名，您可以在提交给 Google 以运行此广告的链接末尾添加以下 UTM 代码。</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">utm_term=marketing+software</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="如何设计" tabindex="-1">如何设计 <a class="header-anchor" href="#如何设计" aria-label="Permalink to &quot;如何设计&quot;">​</a></h3><p>我们知道，在数据埋点上报时，不仅有 UTM 信息，还有一系列其他信息，这样会造成上报数据过大，影响服务性能（响应时间），同时也考虑到 UTM 的外显性，不需要将每个每个上报参数显示出来，所以我推荐以下设计方案：</p><p>形式：</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">https://www.baidu.com/p/utm?utm=wx.mp.page.more.210316</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>思路：</p><ul><li>只用一个参数 utm</li><li>值用点<code>.</code>隔开，按顺序代表一定的值，如果无值可以为空</li><li>每个位的值赋予一定的业务意义</li></ul><p>上例的 UTM 是用于推广来源及效果跟踪分析的，我们对每一位进行业务解释：</p><ul><li>wx：网站推广渠道，来自微信，还可以用微博、知乎等</li><li>mp：渠道的平台，来自公众号，还可以聊天、群组、朋友圈等</li><li>page：渠道的形式，来自公众号文章，还可以有公众号菜单、公众号自动消息</li><li>more：链接名称，公号文章中的更多链接，还可以有文章中的内嵌小程序等</li><li>210316：文章的发布时间，由于咱们进入 21 世纪了，网站大概率活不到 22 世纪，所以年份只保留两位就行</li></ul><p>将数据经过 ETL 后进入到数据库，格式如下：</p><p>| 时间 | 渠道 | 平台 | 形式 | 链接名称 | 发布时间 | | ---------- | ---------- | ---- | ------- | -------- | -------- | ------ | | 2020-05-08 | 11:09:21.0 | wx | mp | page | more | 210316 | | 2020-05-08 | 11:09:20.0 | wx | im | chat | 210316 | | 2020-05-08 | 11:09:19.0 | wx | monents | pis_9 | reviews | 210315 |</p><p>或者直接存储：</p><p>| uuid | ctime | utm | | ---- | ---------- | ---------- | ------------------------------- | | 8675 | 2020-05-08 | 11:09:19.0 | wx.mp.page.more.210316 | | 9726 | 2020-05-08 | 12:09:19.0 | wx.im.chat..210316 | | 3587 | 2020-05-08 | 13:09:19.0 | wx.monents.pis_9.reviews.210315 |</p><p>然后用 SQL 进行查询分析，详见案例：<a href="https://www.gairuo.com/p/hive-sql-case-utm-uv" target="_blank" rel="noreferrer">SQL 按 UTM 串统计访问情况</a>。</p><p>另外，如果业务繁多、团队人员众多，在制定埋点规范时，控制第一位参数按业务分配，后边的参数设计权让渡给业务产品经理，在业务域内进行解释分析。</p><h3 id="扩展" tabindex="-1">扩展 <a class="header-anchor" href="#扩展" aria-label="Permalink to &quot;扩展&quot;">​</a></h3><p>UTM 参数的数据没有限制，但为了保证统一，可以规定最多五位，最小两位，如果不够怎么办？可以对其中一位进行扩展，如以下形式：</p><div class="language-url line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">url</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">https://www.baidu.com/p/utm?utm=wx.mp.page.more.ios-210316-dark</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>我们对最后一位进行了扩展，增加了手机操作系统类型（iOS）和操作系统的界面色深模式（dark 深色模式），注意扩展内容不能再用点相隔。扩展内容也可以是一种外显的列表、字典、JSON 等格式。</p><p>这样，就为 utm 提供了无限可能。</p><h3 id="设计要点" tabindex="-1">设计要点 <a class="header-anchor" href="#设计要点" aria-label="Permalink to &quot;设计要点&quot;">​</a></h3><p>设计 UTM 时需要注意以下几点：</p><ul><li>不要有隐私信息，可经过加密，如用户的 ID、合作公司的名字，渠道的名字</li><li>整体内容和单个参数值不宜过长，因为是 URL 的一部分，URL 长度有限制，其本身还有其他参数</li><li>可以使用短链接技术来解决 URL 中 UTM 外显（一次传播）和 URL 整体过长不利用传播的问题，如微博的 url.cn 和 bit.ly</li><li>UTM 可以记录到 cookie 中，请求接口时终端 header 里加入 utm 参数</li></ul><h3 id="用途" tabindex="-1">用途 <a class="header-anchor" href="#用途" aria-label="Permalink to &quot;用途&quot;">​</a></h3><p>一些典型的应用场景：</p><ul><li>网站或者 APP 在站外的推广效果</li><li>网站或者 APP 在站内的行为路径</li><li>EDM 邮件的效果跟踪</li><li>网络及实体二维码的扫描效果</li></ul><h3 id="数据分析" tabindex="-1">数据分析 <a class="header-anchor" href="#数据分析" aria-label="Permalink to &quot;数据分析&quot;">​</a></h3><ul><li>详见案例：<a href="https://www.gairuo.com/p/hive-sql-case-utm-uv" target="_blank" rel="noreferrer">SQL 按 UTM 串统计访问情况</a>。</li></ul><p>参考</p><ul><li><a href="https://ga-dev-tools.appspot.com/campaign-url-builder/" target="_blank" rel="noreferrer">https://ga-dev-tools.appspot.com/campaign-url-builder/</a></li><li><a href="https://en.wikipedia.org/wiki/Google_Analytics" target="_blank" rel="noreferrer">https://en.wikipedia.org/wiki/Google_Analytics</a></li></ul>',63)];const s=e(n,[["render",function(e,t,i,n,s,p){return a(),l("div",null,r)}]]);export{i as __pageData,s as default};
